<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø®ØªÙŠØ§Ø± ÙØ§Ø¦Ø² - Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');

:root {
  --primary: #ff4757;
  --primary-dark: #ff3838;
  --secondary: #3742fa;
  --dark: #0a0a0a;
  --dark-light: #1a1a1a;
  --light: #ffffff;
  --accent: #ffd32a;
  --success: #2ed573;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
  color: var(--light);
  font-family: 'Cairo', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  overflow-x: hidden;
}

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 900px;
  gap: 30px;
}

.header {
  text-align: center;
  margin-bottom: 10px;
}

.header h1 {
  font-size: 2.8rem;
  background: linear-gradient(to right, var(--primary), var(--accent));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  margin-bottom: 10px;
  text-shadow: 0 0 15px rgba(255, 71, 87, 0.3);
}

.header p {
  color: #aaa;
  font-size: 1.1rem;
  max-width: 600px;
  margin: 0 auto;
}

.timer-display {
  font-size: 1.2rem;
  color: var(--accent);
  margin-top: 10px;
  font-weight: 600;
  background: rgba(255, 211, 42, 0.1);
  padding: 8px 20px;
  border-radius: 30px;
  border: 1px solid rgba(255, 211, 42, 0.3);
}

.content {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
  justify-content: center;
  align-items: center;
  width: 100%;
}

.wheel-container {
  flex: 1;
  min-width: 300px;
  max-width: 400px;
  position: relative;
}

.wheel {
  width: 100%;
  height: 400px;
  position: relative;
  border-radius: 50%;
  background: conic-gradient(
    from 0deg,
    #ff3838 0deg 60deg,
    #3742fa 60deg 120deg,
    #ffd32a 120deg 180deg,
    #2ed573 180deg 240deg,
    #9c88ff 240deg 300deg,
    #ff9ff3 300deg 360deg
  );
  box-shadow: 0 0 40px rgba(255, 71, 87, 0.5),
              inset 0 0 40px rgba(0, 0, 0, 0.8);
  transition: transform 0.1s;
  overflow: hidden;
  border: 8px solid var(--dark);
}

.wheel::before {
  content: '';
  position: absolute;
  width: 50px;
  height: 50px;
  background: var(--primary);
  clip-path: polygon(100% 50%, 0 0, 0 100%);
  top: -25px;
  left: 50%;
  transform: translateX(-50%) rotate(180deg);
  z-index: 10;
  filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.5));
}

.wheel-center {
  position: absolute;
  width: 70px;
  height: 70px;
  background: var(--dark);
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 5;
  border: 5px solid var(--accent);
  box-shadow: 0 0 15px rgba(255, 211, 42, 0.7);
}

.winner-container {
  flex: 1;
  min-width: 300px;
  max-width: 400px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.selection-box {
  background: linear-gradient(145deg, rgba(26, 26, 26, 0.9), rgba(10, 10, 10, 0.9));
  border-radius: 20px;
  padding: 30px;
  border: 2px solid rgba(255, 71, 87, 0.3);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  text-align: center;
  backdrop-filter: blur(10px);
}

.selection-box h2 {
  font-size: 1.8rem;
  margin-bottom: 20px;
  color: var(--light);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.display {
  height: 120px;
  border: 2px dashed rgba(255, 71, 87, 0.5);
  margin: 20px 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  font-weight: 700;
  border-radius: 15px;
  background: rgba(10, 10, 10, 0.7);
  transition: all 0.3s;
  color: var(--accent);
  overflow: hidden;
  position: relative;
}

.display.winner-selected {
  border: 2px solid var(--success);
  box-shadow: 0 0 25px rgba(46, 213, 115, 0.5);
  color: var(--success);
  animation: pulse 1.5s infinite;
}

.display.spinning {
  border: 2px solid var(--primary);
  box-shadow: 0 0 25px rgba(255, 71, 87, 0.5);
  color: var(--primary);
}

.display.slow-spinning {
  border: 2px solid var(--secondary);
  box-shadow: 0 0 25px rgba(55, 66, 250, 0.5);
  color: var(--secondary);
}

button {
  padding: 18px 35px;
  background: linear-gradient(to right, var(--primary), var(--primary-dark));
  color: var(--light);
  border: none;
  border-radius: 12px;
  font-size: 1.2rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
  margin-top: 10px;
  letter-spacing: 1px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(255, 71, 87, 0.3);
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 25px rgba(255, 71, 87, 0.5);
}

button:active {
  transform: translateY(1px);
}

button:disabled {
  background: linear-gradient(to right, #555, #777);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

button::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

button:focus:not(:active)::after {
  animation: ripple 1s ease-out;
}

.winner-info {
  background: linear-gradient(145deg, rgba(26, 26, 26, 0.9), rgba(10, 10, 10, 0.9));
  border-radius: 20px;
  padding: 25px;
  border: 2px solid rgba(46, 213, 115, 0.3);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(10px);
}

.winner-info h3 {
  font-size: 1.5rem;
  margin-bottom: 15px;
  color: var(--success);
  display: flex;
  align-items: center;
  gap: 10px;
}

.info-row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.info-row:last-child {
  border-bottom: none;
}

.info-label {
  color: #aaa;
}

.info-value {
  color: var(--light);
  font-weight: 600;
}

/* ØªØµÙ…ÙŠÙ… Ø²Ø± Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
.whatsapp-toggle {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 8px 15px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 0.9rem;
  color: #aaa;
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 10px;
}

.whatsapp-toggle:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
}

.whatsapp-toggle.active {
  background: rgba(37, 211, 102, 0.2);
  border-color: rgba(37, 211, 102, 0.5);
  color: #25d366;
}

.whatsapp-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.whatsapp-number {
  direction: ltr;
  text-align: left;
  flex: 1;
}

.hidden-number {
  color: #666;
  letter-spacing: 2px;
  font-weight: 400;
}

/* ØªØµÙ…ÙŠÙ… Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ø±Ø¶ */
.confirm-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: linear-gradient(145deg, rgba(26, 26, 26, 0.95), rgba(10, 10, 10, 0.95));
  border-radius: 20px;
  padding: 30px;
  max-width: 400px;
  width: 90%;
  border: 2px solid rgba(255, 71, 87, 0.5);
  text-align: center;
}

.modal-content h3 {
  font-size: 1.5rem;
  margin-bottom: 15px;
  color: var(--accent);
}

.modal-content p {
  color: #ccc;
  margin-bottom: 25px;
  line-height: 1.5;
}

.modal-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
}

.modal-btn {
  padding: 12px 25px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  flex: 1;
}

.modal-btn.confirm {
  background: linear-gradient(to right, #25d366, #1da851);
  color: white;
}

.modal-btn.cancel {
  background: rgba(255, 255, 255, 0.1);
  color: #ccc;
}

.modal-btn:hover {
  transform: translateY(-2px);
}

.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1;
}

.confetti {
  position: absolute;
  width: 10px;
  height: 20px;
  opacity: 0;
}

.stage-indicator {
  margin-top: 15px;
  font-size: 1rem;
  color: #aaa;
  height: 24px;
}

@keyframes pulse {
  0% { box-shadow: 0 0 10px rgba(46, 213, 115, 0.5); }
  50% { box-shadow: 0 0 25px rgba(46, 213, 115, 0.8); }
  100% { box-shadow: 0 0 10px rgba(46, 213, 115, 0.5); }
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  100% {
    transform: scale(50, 50);
    opacity: 0;
  }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes confetti-fall {
  0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@media (max-width: 768px) {
  .content {
    flex-direction: column;
  }
  
  .header h1 {
    font-size: 2.2rem;
  }
  
  .wheel {
    height: 300px;
  }
}
</style>
</head>
<body>
<div class="particles" id="particles"></div>

<div class="container">
  <div class="header">
    <h1>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† ğŸ†</h1>
    <p>Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ø­Ø§ÙŠØ¯ ÙˆØ´ÙØ§Ù Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ø­ØªÙØ§Ù„ÙŠ Ù„Ù„ÙØ§Ø¦Ø²</p>
    <div class="timer-display" id="timerDisplay">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 00:30</div>
  </div>
  
  <div class="content">
    <div class="wheel-container">
      <div class="wheel" id="wheel"></div>
      <div class="wheel-center"></div>
    </div>
    
    <div class="winner-container">
      <div class="selection-box">
        <h2>ğŸ‘‘ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø²</h2>
        <div class="display" id="roll">---</div>
        <div class="stage-indicator" id="stageIndicator">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡</div>
        <button id="pickWinnerBtn" onclick="startSelection()">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ğŸ¯</button>
        <div style="margin-top: 20px; color: #aaa; font-size: 0.9rem;">
          <p>Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±: 30 Ø«Ø§Ù†ÙŠØ© - Ø³ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
          <p id="participantCount">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†...</p>
        </div>
      </div>
      
      <div class="winner-info" id="winnerInfo" style="display: none;">
        <h3>ğŸ† Ø§Ù„ÙØ§Ø¦Ø² Ø§Ù„Ù…Ø­Ø¸ÙˆØ¸</h3>
        <div class="info-row">
          <span class="info-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
          <span class="info-value" id="winnerName">---</span>
        </div>
        <div class="info-row">
          <span class="info-label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</span>
          <div class="whatsapp-container">
            <span class="info-value whatsapp-number hidden-number" id="hiddenWhatsapp">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
            <button class="whatsapp-toggle" onclick="toggleWhatsapp()" id="whatsappToggle">
              <span>ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±</span>
            </button>
          </div>
        </div>
        <div class="info-row">
          <span class="info-label">ÙˆÙ‚Øª Ø§Ù„ÙÙˆØ²:</span>
          <span class="info-value" id="winTime">---</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ -->
<div class="confirm-modal" id="confirmModal" style="display: none;">
  <div class="modal-content">
    <h3>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h3>
    <p>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¹ØªØ¨Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø®Ø§ØµØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…ØŸ</p>
    <p style="font-size: 0.9rem; color: #ff4757;">Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</p>
    <div class="modal-buttons">
      <button class="modal-btn confirm" onclick="confirmShowWhatsapp()">Ù†Ø¹Ù…ØŒ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù‚Ù…</button>
      <button class="modal-btn cancel" onclick="cancelShowWhatsapp()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let participants = [];
let isSpinning = false;
let selectionTimer = null;
let timeLeft = 30;
let currentStage = 0;
let currentWinner = null;

// Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
function createParticles() {
  const particlesContainer = document.getElementById('particles');
  const colors = ['#ff4757', '#3742fa', '#ffd32a', '#2ed573', '#9c88ff', '#ff9ff3'];
  
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + 'vw';
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.width = Math.random() * 10 + 5 + 'px';
    confetti.style.height = Math.random() * 20 + 10 + 'px';
    confetti.style.opacity = '0';
    particlesContainer.appendChild(confetti);
  }
}

// ØªÙØ¹ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ®Ø±Ø¬
function activateConfetti() {
  const confettiElements = document.querySelectorAll('.confetti');
  confettiElements.forEach(confetti => {
    confetti.style.left = Math.random() * 100 + 'vw';
    confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
    confetti.style.opacity = '1';
    
    setTimeout(() => {
      confetti.style.animation = '';
      confetti.style.opacity = '0';
    }, 5000);
  });
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
async function updateParticipantCount() {
  try {
    const snap = await db.ref("wheel_users").get();
    if (snap.exists()) {
      participants = [];
      snap.forEach(c => participants.push({id: c.key, ...c.val()}));
      document.getElementById('participantCount').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${participants.length}`;
    } else {
      document.getElementById('participantCount').textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹';
    }
  } catch (error) {
    console.error("Error fetching participants:", error);
  }
}

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ù…Ù‚Ø±ÙˆØ¡
function formatTime(timestamp) {
  const date = new Date(timestamp);
  return date.toLocaleString('ar-EG', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
function updateTimer() {
  const minutes = Math.floor(timeLeft / 60);
  const seconds = timeLeft % 60;
  document.getElementById('timerDisplay').textContent = 
    `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  
  if (timeLeft > 0) {
    timeLeft--;
  }
}

// ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø©
function spinWheel(duration, finalAngle = 0) {
  const wheel = document.getElementById('wheel');
  wheel.style.transition = `transform ${duration}ms cubic-bezier(0.2, 0.8, 0.3, 1)`;
  wheel.style.transform = `rotate(${finalAngle}deg)`;
}

// Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
function startSelection() {
  if (isSpinning) return;
  
  const btn = document.getElementById('pickWinnerBtn');
  const display = document.getElementById('roll');
  
  // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø´ØªØ±ÙƒÙŠÙ†
  if (participants.length === 0) {
    alert("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ");
    return;
  }
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
  isSpinning = true;
  timeLeft = 30;
  currentStage = 1;
  btn.disabled = true;
  btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±...';
  display.classList.remove('winner-selected');
  display.classList.add('spinning');
  
  // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§Ø¦Ø² Ø§Ù„Ø³Ø§Ø¨Ù‚
  document.getElementById('winnerInfo').style.display = 'none';
  
  // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
  selectionTimer = setInterval(updateTimer, 1000);
  updateTimer();
  
  // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹ (5 Ø«ÙˆØ§Ù†ÙŠ)
  document.getElementById('stageIndicator').textContent = 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±ÙŠØ¹';
  
  let i = 0;
  const fastInterval = setInterval(() => {
    display.textContent = participants[i % participants.length].roblox;
    i++;
  }, 80); // Ø£Ø³Ø±Ø¹
  
  // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ø³Ø±Ø¹Ø©
  const spins = 8;
  const totalRotation = 360 * spins;
  spinWheel(5000, totalRotation);
  
  // Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©
  setTimeout(() => {
    clearInterval(fastInterval);
    currentStage = 2;
    document.getElementById('stageIndicator').textContent = 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªÙˆØ³Ø·';
    display.classList.remove('spinning');
    display.classList.add('slow-spinning');
    
    let j = i % participants.length;
    const mediumInterval = setInterval(() => {
      display.textContent = participants[j % participants.length].roblox;
      j++;
    }, 150); // Ø£Ø¨Ø·Ø£
    
    // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ø³Ø±Ø¹Ø© Ù…ØªÙˆØ³Ø·Ø©
    spinWheel(10000, totalRotation + 360 * 4);
    
    // Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†ÙŠ Ø¥Ø¶Ø§ÙÙŠØ©ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ø·ÙŠØ¦Ø©
    setTimeout(() => {
      clearInterval(mediumInterval);
      currentStage = 3;
      document.getElementById('stageIndicator').textContent = 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·ÙŠØ¡ - Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„ÙØ§Ø¦Ø²';
      
      let k = j % participants.length;
      const slowInterval = setInterval(() => {
        display.textContent = participants[k % participants.length].roblox;
        k++;
      }, 300); // Ø£Ø¨Ø·Ø£ ÙƒØ«ÙŠØ±Ø§Ù‹
      
      // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¨Ø¨Ø·Ø¡
      spinWheel(15000, totalRotation + 360 * 8);
      
      // Ø¨Ø¹Ø¯ 15 Ø«Ø§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©ØŒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø² (Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ 30 Ø«Ø§Ù†ÙŠØ©)
      setTimeout(async () => {
        clearInterval(slowInterval);
        clearInterval(selectionTimer);
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
        const winner = participants[Math.floor(Math.random() * participants.length)];
        currentWinner = winner;
        
        // Ø¹Ø±Ø¶ Ø§Ù„ÙØ§Ø¦Ø²
        display.textContent = winner.roblox;
        display.classList.remove('slow-spinning');
        display.classList.add('winner-selected');
        document.getElementById('stageIndicator').textContent = 'ğŸ‰ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø²!';
        
        // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¥Ù„Ù‰ Ù…ÙˆØ¶Ø¹ Ø§Ù„ÙØ§Ø¦Ø²
        const winnerIndex = participants.indexOf(winner);
        const winnerAngle = 360 - (winnerIndex * (360 / participants.length));
        const finalAngle = totalRotation + 360 * 12 + winnerAngle;
        
        spinWheel(2000, finalAngle);
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§Ø¦Ø²
        document.getElementById('winnerName').textContent = winner.roblox;
        document.getElementById('hiddenWhatsapp').textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
        document.getElementById('winTime').textContent = formatTime(Date.now());
        document.getElementById('winnerInfo').style.display = 'block';
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
        const toggleBtn = document.getElementById('whatsappToggle');
        toggleBtn.innerHTML = '<span>ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±</span>';
        toggleBtn.classList.remove('active');
        
        // ØªÙØ¹ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ®Ø±Ø¬
        activateConfetti();
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        try {
          // Ø­Ø°Ù Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
          await db.ref("wheel_users/" + winner.id).remove();
          
          // Ø­Ø°Ù IP Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø´ØªØ±Ùƒ
          if (winner.ip) {
            await db.ref("ips/" + winner.ip.replace(/\./g, '_')).remove();
          }
          
          // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§Ø¦Ø²
          await db.ref("winners").push({
            roblox: winner.roblox,
            whatsapp: winner.whatsapp,
            time: Date.now()
          });
          
          console.log("Ø§Ù„ÙØ§Ø¦Ø² ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­:", winner.roblox);
        } catch (error) {
          console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
          alert("âš ï¸ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø² Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.");
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
        participants = participants.filter(p => p.id !== winner.id);
        document.getElementById('participantCount').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${participants.length}`;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø²Ø±
        btn.disabled = false;
        btn.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ğŸ¯';
        isSpinning = false;
        
      }, 15000); // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ø·ÙŠØ¦Ø©
    }, 10000); // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©
  }, 5000); // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
}

// Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
function toggleWhatsapp() {
  if (!currentWinner || !currentWinner.whatsapp) return;
  
  const toggleBtn = document.getElementById('whatsappToggle');
  const whatsappDisplay = document.getElementById('hiddenWhatsapp');
  
  if (toggleBtn.classList.contains('active')) {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…
    whatsappDisplay.textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
    toggleBtn.innerHTML = '<span>ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±</span>';
    toggleBtn.classList.remove('active');
  } else {
    // Ø·Ù„Ø¨ ØªØ£ÙƒÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø±
    document.getElementById('confirmModal').style.display = 'flex';
  }
}

// ØªØ£ÙƒÙŠØ¯ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
function confirmShowWhatsapp() {
  const toggleBtn = document.getElementById('whatsappToggle');
  const whatsappDisplay = document.getElementById('hiddenWhatsapp');
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ù‚Ù…
  whatsappDisplay.textContent = currentWinner.whatsapp;
  whatsappDisplay.classList.remove('hidden-number');
  toggleBtn.innerHTML = '<span>ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡</span>';
  toggleBtn.classList.add('active');
  
  // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
  document.getElementById('confirmModal').style.display = 'none';
  
  // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  console.log("ØªÙ… Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ÙØ§Ø¦Ø²:", currentWinner.roblox);
}

// Ø¥Ù„ØºØ§Ø¡ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
function cancelShowWhatsapp() {
  document.getElementById('confirmModal').style.display = 'none';
}

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
document.addEventListener('DOMContentLoaded', function() {
  createParticles();
  updateParticipantCount();
  
  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù
  setInterval(updateParticipantCount, 10000);
  
  // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø·ÙÙˆ Ù„Ù„Ø¹Ø¬Ù„Ø©
  const wheel = document.getElementById('wheel');
  setInterval(() => {
    wheel.style.transform = wheel.style.transform + ' translateY(-5px)';
    setTimeout(() => {
      wheel.style.transform = wheel.style.transform.replace(' translateY(-5px)', '');
    }, 1000);
  }, 2000);
});
</script>
</body>
            </html> 
