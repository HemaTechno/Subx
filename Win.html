<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ø®ØªÙŠØ§Ø± ÙØ§Ø¦Ø²</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{background:#000;color:#fff;font-family:cairo;display:flex;justify-content:center;align-items:center;height:100vh}
.box{border:2px solid red;padding:30px;border-radius:15px;text-align:center;width:350px}
.display{height:70px;border:1px dashed red;margin:15px 0;display:flex;align-items:center;justify-content:center}
button{padding:12px 25px;background:red;color:#fff;border:none;border-radius:10px;font-size:16px}
</style>
</head>
<body>

<div class="box">
  <h2>ğŸ¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø²</h2>
  <div class="display" id="roll">---</div>
  <button onclick="pickWinner()">Ø§Ø®ØªÙŠØ§Ø± ÙØ§Ø¦Ø²</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

async function pickWinner(){
  const snap = await db.ref("wheel_users").get();
  if(!snap.exists()) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ†");

  const users=[];
  snap.forEach(c=>users.push({id:c.key,...c.val()}));

  let i=0;
  const roll=setInterval(()=>{
    document.getElementById("roll").textContent=users[i%users.length].roblox;
    i++;
  },80);

  setTimeout(async ()=>{
    clearInterval(roll);
    const winner=users[Math.floor(Math.random()*users.length)];
    document.getElementById("roll").textContent=winner.roblox;

    // Ø­Ø°Ù Ø§Ù„Ù…Ø´ØªØ±Ùƒ
    await db.ref("wheel_users/"+winner.id).remove();

    // Ø­Ø°Ù IP
    if(winner.ip){
      await db.ref("ips/"+winner.ip.replace(/\./g,'_')).remove();
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§Ø¦Ø² (Ù‡Ù†Ø§ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡ØªØªØ¨Ø¹Øª)
    await db.ref("winners").push({
      roblox:winner.roblox,
      whatsapp:winner.whatsapp,
      time:Date.now()
    });

  },3000);
}
</script>
</body>
</html>
